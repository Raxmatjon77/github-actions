build-job:
  stage: build
  script:
    - apt-get update && apt-get install -y curl  # Install curl
    - |
      send_message() {
        curl -s -X POST "https://api.telegram.org/bot${8028072110:AAG5ERdmz3za_N5YXM9JPp8JTMO6XEqcAv8}/sendMessage" \
          -d chat_id="${1955031743}" \
          -d text="$1"
      }
      send_message "üöÄ Build started\nBranch: ${CI_COMMIT_BRANCH}\nAuthor: ${CI_COMMIT_AUTHOR}\nMessage: ${CI_COMMIT_MESSAGE}\nTime: $(date '+%Y-%m-%d %H:%M:%S')"
    - docker build -t qazo-namoz-image .
  only:
    - main
  after_script:
    - apt-get update && apt-get install -y curl  # Install curl in after_script too
    - |
      send_message() {
        curl -s -X POST "https://api.telegram.org/bot${8028072110:AAG5ERdmz3za_N5YXM9JPp8JTMO6XEqcAv8}/sendMessage" \
          -d chat_id="${1955031743}" \
          -d text="$1"
      }
      if [[ "$CI_JOB_STATUS" == "failed" ]]; then
        send_message "‚ùå Build failed\nBranch: ${CI_COMMIT_BRANCH}\nAuthor: ${CI_COMMIT_AUTHOR}\nMessage: ${CI_COMMIT_MESSAGE}\nTime: $(date '+%Y-%m-%d %H:%M:%S')"
      fi

deploy-job:
  stage: deploy
  script:
    - apt-get update && apt-get install -y curl  # Install curl
    - docker-compose up -d
  only:
    - main
  after_script:
    - apt-get update && apt-get install -y curl  # Install curl in after_script
    - |
      send_message() {
        curl -s -X POST "https://api.telegram.org/bot${8028072110:AAG5ERdmz3za_N5YXM9JPp8JTMO6XEqcAv8}/sendMessage" \
          -d chat_id="${1955031743}" \
          -d text="$1"
      }
      if [[ "$CI_JOB_STATUS" == "success" ]]; then
        send_message "‚úÖ Deploy succeeded\nBranch: ${CI_COMMIT_BRANCH}\nAuthor: ${CI_COMMIT_AUTHOR}\nMessage: ${CI_COMMIT_MESSAGE}\nTime: $(date '+%Y-%m-%d %H:%M:%S')"
      else
        send_message "‚ùå Deploy failed\nBranch: ${CI_COMMIT_BRANCH}\nAuthor: ${CI_COMMIT_AUTHOR}\nMessage: ${CI_COMMIT_MESSAGE}\nTime: $(date '+%Y-%m-%d %H:%M:%S')"
      fi

